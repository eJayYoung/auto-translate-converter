{"version":3,"sources":["../../../lib/doc/workbook.js"],"names":["Worksheet","require","DefinedNames","XLSX","CSV","Workbook","module","exports","created","Date","modified","properties","_worksheets","views","media","_definedNames","prototype","xlsx","_xlsx","csv","_csv","nextId","i","length","addWorksheet","name","options","id","console","trace","tabColor","argb","theme","indexed","worksheetOptions","Object","assign","workbook","worksheet","removeWorksheetEx","removeWorksheet","getWorksheet","destroy","undefined","find","worksheets","filter","Boolean","eachSheet","iteratee","forEach","sheet","definedNames","clearThemes","_themes","addImage","image","push","type","getImage","model","creator","lastModifiedBy","lastPrinted","map","company","manager","title","subject","keywords","category","description","language","revision","contentStatus","themes","value","worksheetModel"],"mappings":"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","file":"workbook.js","sourcesContent":["/**\r\n * Copyright (c) 2014-2017 Guyon Roche\r\n * LICENCE: MIT - please refer to LICENCE file included with this module\r\n * or https://github.com/guyonroche/exceljs/blob/master/LICENSE\r\n */\r\n\r\n'use strict';\r\n\r\nvar Worksheet = require('./worksheet');\r\nvar DefinedNames = require('./defined-names');\r\nvar XLSX = require('./../xlsx/xlsx');\r\nvar CSV = require('./../csv/csv');\r\n\r\n// Workbook requirements\r\n//  Load and Save from file and stream\r\n//  Access/Add/Delete individual worksheets\r\n//  Manage String table, Hyperlink table, etc.\r\n//  Manage scaffolding for contained objects to write to/read from\r\n\r\nvar Workbook = module.exports = function() {\r\n  this.created = new Date();\r\n  this.modified = this.created;\r\n  this.properties = {};\r\n  this._worksheets = [];\r\n  this.views = [];\r\n  this.media = [];\r\n  this._definedNames = new DefinedNames();\r\n};\r\n\r\nWorkbook.prototype = {\r\n  get xlsx() {\r\n    return this._xlsx || (this._xlsx = new XLSX(this));\r\n  },\r\n  get csv() {\r\n    return this._csv || (this._csv = new CSV(this));\r\n  },\r\n  get nextId() {\r\n    // find the next unique spot to add worksheet\r\n    var i;\r\n    for (i = 1; i < this._worksheets.length; i++) {\r\n      if (!this._worksheets[i]) {\r\n        return i;\r\n      }\r\n    }\r\n    return this._worksheets.length || 1;\r\n  },\r\n  addWorksheet: function(name, options) {\r\n    var id = this.nextId;\r\n    name = name || 'sheet' + id;\r\n    \r\n    // if options is a color, call it tabColor (and signal deprecated message)\r\n    if (options) {\r\n      if (typeof options === 'string') {\r\n        // eslint-disable-next-line no-console\r\n        console.trace('tabColor argument is now deprecated. Please use workbook.addWorksheet(name, {properties: { tabColor: { argb: \"rbg value\" } }');\r\n        options = {\r\n          properties: {\r\n            tabColor: {argb: options}\r\n          }\r\n        };\r\n      } else if (options.argb || options.theme || options.indexed) {\r\n        // eslint-disable-next-line no-console\r\n        console.trace('tabColor argument is now deprecated. Please use workbook.addWorksheet(name, {properties: { tabColor: { ... } }');\r\n        options = {\r\n          properties: {\r\n            tabColor: options\r\n          }\r\n        };\r\n      }\r\n    }\r\n\r\n    var worksheetOptions = Object.assign({}, options, {\r\n      id: id,\r\n      name: name,\r\n      workbook: this\r\n    });\r\n\r\n    var worksheet = new Worksheet(worksheetOptions);\r\n\r\n    this._worksheets[id] = worksheet;\r\n    return worksheet;\r\n  },\r\n  removeWorksheetEx: function(worksheet) {\r\n    delete this._worksheets[worksheet.id];\r\n  },\r\n  removeWorksheet: function(id) {\r\n    var worksheet = this.getWorksheet(id);\r\n    if (worksheet) {\r\n      worksheet.destroy();\r\n    }\r\n  },\r\n\r\n  getWorksheet: function(id) {\r\n    if (id === undefined) {\r\n      return this._worksheets.find(function(worksheet) { return worksheet; });\r\n    } else if (typeof id === 'number') {\r\n      return this._worksheets[id];\r\n    } else if (typeof id === 'string') {\r\n      return this._worksheets.find(function(worksheet) {\r\n        return worksheet && worksheet.name === id;\r\n      });\r\n    }\r\n    return undefined;\r\n  },\r\n\r\n  get worksheets() {\r\n    // return a clone of _worksheets\r\n    return this._worksheets.filter(Boolean);\r\n  },\r\n\r\n  eachSheet: function(iteratee) {\r\n    this._worksheets.forEach(function(sheet) {\r\n      iteratee(sheet, sheet.id);\r\n    });\r\n  },\r\n\r\n  get definedNames() {\r\n    return this._definedNames;\r\n  },\r\n\r\n  clearThemes: function() {\r\n    // Note: themes are not an exposed feature, meddle at your peril!\r\n    this._themes = undefined;\r\n  },\r\n\r\n  addImage: function(image) {\r\n    // TODO:  validation?\r\n    var id = this.media.length;\r\n    this.media.push(\r\n      Object.assign(\r\n        {},\r\n        image,\r\n        { type: 'image' }\r\n      )\r\n    );\r\n    return id;\r\n  },\r\n\r\n  getImage(id) {\r\n    return this.media[id];\r\n  },\r\n\r\n  get model() {\r\n    return {\r\n      creator: this.creator || 'Unknown',\r\n      lastModifiedBy: this.lastModifiedBy || 'Unknown',\r\n      lastPrinted: this.lastPrinted,\r\n      created: this.created,\r\n      modified: this.modified,\r\n      properties: this.properties,\r\n      worksheets: this._worksheets.filter(Boolean).map(function(worksheet) { return worksheet.model; }),\r\n      definedNames: this._definedNames.model,\r\n      views: this.views,\r\n      company: this.company,\r\n      manager: this.manager,\r\n      title: this.title,\r\n      subject: this.subject,\r\n      keywords: this.keywords,\r\n      category: this.category,\r\n      description: this.description,\r\n      language: this.language,\r\n      revision: this.revision,\r\n      contentStatus: this.contentStatus,\r\n      themes: this._themes,\r\n      media: this.media,\r\n    };\r\n  },\r\n  set model(value) {\r\n    this.creator = value.creator;\r\n    this.lastModifiedBy = value.lastModifiedBy;\r\n    this.lastPrinted = value.lastPrinted;\r\n    this.created = value.created;\r\n    this.modified = value.modified;\r\n    this.company = value.company;\r\n    this.manager = value.manager;\r\n    this.title = value.title;\r\n    this.subject = value.subject;\r\n    this.keywords = value.keywords;\r\n    this.category = value.category;\r\n    this.description = value.description;\r\n    this.language = value.language;\r\n    this.revision = value.revision;\r\n    this.contentStatus = value.contentStatus;\r\n\r\n    this.properties = value.properties;\r\n    this._worksheets = [];\r\n    value.worksheets.forEach(worksheetModel => {\r\n      var id = worksheetModel.id;\r\n      var name = worksheetModel.name;\r\n      var worksheet = this._worksheets[id] = new Worksheet({\r\n        id: id,\r\n        name: name,\r\n        workbook: this\r\n      });\r\n\r\n      worksheet.model = worksheetModel;\r\n    });\r\n\r\n    this._definedNames.model = value.definedNames;\r\n    this.views = value.views;\r\n    this._themes = value.themes;\r\n    this.media = value.media || [];\r\n  }\r\n};\r\n"]}