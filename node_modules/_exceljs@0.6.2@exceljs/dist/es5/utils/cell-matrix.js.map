{"version":3,"sources":["../../../lib/utils/cell-matrix.js"],"names":["_","require","colCache","CellMatrix","template","sheets","prototype","addCell","addressStr","addCellEx","decodeEx","getCell","findCellEx","findCell","findCellAt","sheetName","rowNumber","colNumber","sheet","row","address","top","bottom","col","left","right","getCellAt","getCellEx","create","findSheet","findSheetRow","findRowCell","n2l","removeCellEx","forEach","callback","each","cell","map","results","push","name","undefined","Object","assign","JSON","parse","stringify","module","exports"],"mappings":"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","file":"cell-matrix.js","sourcesContent":["/**\r\n * Copyright (c) 2016-2017 Guyon Roche\r\n * LICENCE: MIT - please refer to LICENCE file included with this module\r\n * or https://github.com/guyonroche/exceljs/blob/master/LICENSE\r\n */\r\n\r\n'use strict';\r\n\r\nvar _ = require('./under-dash');\r\nvar colCache = require('./col-cache');\r\n\r\nvar CellMatrix = function(template) {\r\n  this.template = template;\r\n  this.sheets = {};\r\n};\r\n\r\nCellMatrix.prototype = {\r\n  addCell: function(addressStr) {\r\n    this.addCellEx(colCache.decodeEx(addressStr));\r\n  },\r\n  getCell: function(addressStr) {\r\n    return this.findCellEx(colCache.decodeEx(addressStr), true);\r\n  },\r\n  findCell: function(addressStr) {\r\n    return this.findCellEx(colCache.decodeEx(addressStr), false);\r\n  },\r\n\r\n  findCellAt: function(sheetName, rowNumber, colNumber) {\r\n    var sheet = this.sheets[sheetName];\r\n    var row = sheet && sheet[rowNumber];\r\n    return row && row[colNumber];\r\n  },\r\n  addCellEx: function(address) {\r\n    if (address.top) {\r\n      for (var row = address.top; row <= address.bottom; row++) {\r\n        for (var col = address.left; col <= address.right; col++) {\r\n          this.getCellAt(address.sheetName, row, col);\r\n        }\r\n      }\r\n    } else {\r\n      this.findCellEx(address, true);\r\n    }\r\n  },\r\n  getCellEx: function(address) {\r\n    return this.findCellEx(address, true);\r\n  },\r\n  findCellEx: function(address, create) {\r\n    var sheet = this.findSheet(address, create);\r\n    var row = this.findSheetRow(sheet, address, create);\r\n    return this.findRowCell(row, address, create);\r\n  },\r\n  getCellAt: function(sheetName, rowNumber, colNumber) {\r\n    var sheet = this.sheets[sheetName] || (this.sheets[sheetName] = []);\r\n    var row = sheet[rowNumber] || (sheet[rowNumber] = []);\r\n    return row[colNumber] || (row[colNumber] = {\r\n      sheetName: sheetName,\r\n      address: colCache.n2l(colNumber) + rowNumber,\r\n      row: rowNumber,\r\n      col: colNumber\r\n    });\r\n  },\r\n\r\n  removeCellEx: function(address) {\r\n    var sheet = this.findSheet(address);\r\n    if (!sheet) { return; }\r\n    var row = this.findSheetRow(sheet, address);\r\n    if (!row) { return; }\r\n    delete row[address.col];\r\n  },\r\n\r\n  forEach: function(callback) {\r\n    _.each(this.sheets, function(sheet) {\r\n      if (sheet) {\r\n        sheet.forEach(function(row) {\r\n          if (row) {\r\n            row.forEach(function(cell) {\r\n              if (cell) {\r\n                callback(cell);\r\n              }\r\n            });\r\n          }\r\n        });\r\n      }\r\n    });\r\n  },\r\n  map: function(callback) {\r\n    var results = [];\r\n    this.forEach(function(cell) { results.push(callback(cell)); });\r\n    return results;\r\n  },\r\n\r\n  findSheet: function(address, create) {\r\n    var name = address.sheetName;\r\n    if (this.sheets[name]) {\r\n      return this.sheets[name];\r\n    }\r\n    if (create) {\r\n      return (this.sheets[name] = []);\r\n    }\r\n    return undefined;\r\n  },\r\n  findSheetRow: function(sheet, address, create) {\r\n    var row = address.row;\r\n    if (sheet && sheet[row]) {\r\n      return sheet[row];\r\n    }\r\n    if (create) {\r\n      return (sheet[row] = []);\r\n    }\r\n    return undefined;\r\n  },\r\n  findRowCell: function(row, address, create) {\r\n    var col = address.col;\r\n    if (row && row[col]) {\r\n      return row[col];\r\n    }\r\n    if (create) {\r\n      return (row[col] = this.template ? Object.assign(address, JSON.parse(JSON.stringify(this.template))) : address);\r\n    }\r\n    return undefined;\r\n  }\r\n};\r\n\r\nmodule.exports = CellMatrix;\r\n"]}