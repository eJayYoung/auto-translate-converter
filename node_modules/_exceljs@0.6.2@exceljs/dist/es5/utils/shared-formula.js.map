{"version":3,"sources":["../../../lib/utils/shared-formula.js"],"names":["colCache","require","replacementCandidateRx","CRrx","slideFormula","formula","fromCell","toCell","offset","decode","to","replace","refMatch","sheet","sheetMaybe","addrPart","trailingParen","match","exec","colDollar","colStr","toUpperCase","rowDollar","rowStr","length","col","l2n","row","parseInt","res","n2l","module","exports"],"mappings":"AAAA;;;;;;AAMA;;AAEA,IAAIA,WAAWC,QAAQ,aAAR,CAAf;;AAEA;AACA,IAAIC,yBAAyB,4CAA7B;AACA,IAAIC,OAAO,sCAAX;;AAEA,IAAIC,eAAe,SAAfA,YAAe,CAASC,OAAT,EAAkBC,QAAlB,EAA4BC,MAA5B,EAAoC;AACrD,MAAIC,SAASR,SAASS,MAAT,CAAgBH,QAAhB,CAAb;AACA,MAAII,KAAKV,SAASS,MAAT,CAAgBF,MAAhB,CAAT;AACA,SAAOF,QAAQM,OAAR,CAAgBT,sBAAhB,EAAwC,UAASU,QAAT,EAAmBC,KAAnB,EAA0BC,UAA1B,EAAsCC,QAAtC,EAAgDC,aAAhD,EAA+D;AAC5G,QAAIA,aAAJ,EAAmB;AACjB,aAAOJ,QAAP;AACD;AACD,QAAIK,QAAQd,KAAKe,IAAL,CAAUH,QAAV,CAAZ;AACA,QAAIE,KAAJ,EAAW;AACT,UAAIE,YAAYF,MAAM,CAAN,CAAhB;AACA,UAAIG,SAASH,MAAM,CAAN,EAASI,WAAT,EAAb;AACA,UAAIC,YAAYL,MAAM,CAAN,CAAhB;AACA,UAAIM,SAASN,MAAM,CAAN,CAAb;AACA,UAAIG,OAAOI,MAAP,GAAgB,CAAhB,IAAsBJ,OAAOI,MAAP,KAAkB,CAAlB,IAAuBJ,SAAS,KAA1D,EAAkE;AAChE;AACA,eAAOR,QAAP;AACD;AACD,UAAIa,MAAMzB,SAAS0B,GAAT,CAAaN,MAAb,CAAV;AACA,UAAIO,MAAMC,SAASL,MAAT,EAAiB,EAAjB,CAAV;AACA,UAAI,CAACJ,SAAL,EAAgB;AACdM,eAAOf,GAAGe,GAAH,GAASjB,OAAOiB,GAAvB;AACD;AACD,UAAI,CAACH,SAAL,EAAgB;AACdK,eAAOjB,GAAGiB,GAAH,GAASnB,OAAOmB,GAAvB;AACD;AACD,UAAIE,MAAM,CAAChB,SAAS,EAAV,KAAiBM,aAAa,EAA9B,IAAoCnB,SAAS8B,GAAT,CAAaL,GAAb,CAApC,IAAyDH,aAAa,EAAtE,IAA4EK,GAAtF;AACA,aAAOE,GAAP;AACD;AACD,WAAOjB,QAAP;AACD,GA1BM,CAAP;AA2BD,CA9BD;;AAgCAmB,OAAOC,OAAP,GAAiB;AACf5B;AADe,CAAjB","file":"shared-formula.js","sourcesContent":["/**\r\n * Copyright (c) 2017 Morten Ulrik SÃ¸rensen\r\n * LICENCE: MIT - please refer to LICENCE file included with this module\r\n * or https://github.com/guyonroche/exceljs/blob/master/LICENSE\r\n */\r\n\r\n'use strict';\r\n\r\nvar colCache = require('./col-cache');\r\n\r\n// var cellRefRegex = /(([a-z_\\-0-9]*)!)?[$]?([a-z]+)[$]?([1-9][0-9]*)/i;\r\nvar replacementCandidateRx = /(([a-z_\\-0-9]*)!)?([a-z0-9_$]{2,})([(])?/ig;\r\nvar CRrx = /^([$])?([a-z]+)([$])?([1-9][0-9]*)$/i;\r\n\r\nvar slideFormula = function(formula, fromCell, toCell) {\r\n  var offset = colCache.decode(fromCell);\r\n  var to = colCache.decode(toCell);\r\n  return formula.replace(replacementCandidateRx, function(refMatch, sheet, sheetMaybe, addrPart, trailingParen) {\r\n    if (trailingParen) {\r\n      return refMatch;\r\n    }\r\n    var match = CRrx.exec(addrPart);\r\n    if (match) {\r\n      var colDollar = match[1];\r\n      var colStr = match[2].toUpperCase();\r\n      var rowDollar = match[3];\r\n      var rowStr = match[4];\r\n      if (colStr.length > 3 || (colStr.length === 3 && colStr > 'XFD')) {\r\n        // > XFD is the highest col number in excel 2007 and beyond, so this is a named range\r\n        return refMatch;\r\n      }\r\n      var col = colCache.l2n(colStr);\r\n      var row = parseInt(rowStr, 10);\r\n      if (!colDollar) {\r\n        col += to.col - offset.col;\r\n      }\r\n      if (!rowDollar) {\r\n        row += to.row - offset.row;\r\n      }\r\n      var res = (sheet || '') + (colDollar || '') + colCache.n2l(col) + (rowDollar || '') + row;\r\n      return res;\r\n    }\r\n    return refMatch;\r\n  });\r\n};\r\n\r\nmodule.exports = {\r\n  slideFormula\r\n};\r\n"]}