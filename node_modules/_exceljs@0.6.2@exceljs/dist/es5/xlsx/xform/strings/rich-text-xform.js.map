{"version":3,"sources":["../../../../../lib/xlsx/xform/strings/rich-text-xform.js"],"names":["TextXform","require","FontXform","utils","BaseXform","RichTextXform","module","exports","model","FONT_OPTIONS","tagName","fontNameTag","inherits","tag","textXform","_textXform","fontXform","_fontXform","render","xmlStream","openNode","font","text","closeNode","parseOpen","node","parser","name","parseText","parseClose","undefined"],"mappings":"AAAA;;;;;;AAMA;;AAEA,IAAIA,YAAYC,QAAQ,cAAR,CAAhB;AACA,IAAIC,YAAYD,QAAQ,qBAAR,CAAhB;;AAEA,IAAIE,QAAQF,QAAQ,sBAAR,CAAZ;AACA,IAAIG,YAAYH,QAAQ,eAAR,CAAhB;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,IAAII,gBAAgBC,OAAOC,OAAP,GAAiB,UAASC,KAAT,EAAgB;AACnD,OAAKA,KAAL,GAAaA,KAAb;AACD,CAFD;;AAIAH,cAAcI,YAAd,GAA6B;AAC3BC,WAAS,KADkB;AAE3BC,eAAa;AAFc,CAA7B;;AAKAR,MAAMS,QAAN,CAAeP,aAAf,EAA8BD,SAA9B,EAAyC;;AAEvC,MAAIS,GAAJ,GAAU;AAAE,WAAO,GAAP;AAAa,GAFc;;AAIvC,MAAIC,SAAJ,GAAgB;AAAE,WAAO,KAAKC,UAAL,KAAoB,KAAKA,UAAL,GAAkB,IAAIf,SAAJ,EAAtC,CAAP;AAAgE,GAJ3C;AAKvC,MAAIgB,SAAJ,GAAgB;AAAE,WAAO,KAAKC,UAAL,KAAoB,KAAKA,UAAL,GAAkB,IAAIf,SAAJ,CAAcG,cAAcI,YAA5B,CAAtC,CAAP;AAA0F,GALrE;;AAOvCS,UAAQ,gBAASC,SAAT,EAAoBX,KAApB,EAA2B;AACjCA,YAAQA,SAAS,KAAKA,KAAtB;;AAEAW,cAAUC,QAAV,CAAmB,GAAnB;AACA,QAAIZ,MAAMa,IAAV,EAAgB;AACd,WAAKL,SAAL,CAAeE,MAAf,CAAsBC,SAAtB,EAAiCX,MAAMa,IAAvC;AACD;AACD,SAAKP,SAAL,CAAeI,MAAf,CAAsBC,SAAtB,EAAiCX,MAAMc,IAAvC;AACAH,cAAUI,SAAV;AACD,GAhBsC;;AAkBvCC,aAAW,mBAASC,IAAT,EAAe;AACxB,QAAI,KAAKC,MAAT,EAAiB;AACf,WAAKA,MAAL,CAAYF,SAAZ,CAAsBC,IAAtB;AACA,aAAO,IAAP;AACD;AACD,YAAQA,KAAKE,IAAb;AACE,WAAK,GAAL;AACE,aAAKnB,KAAL,GAAa,EAAb;AACA,eAAO,IAAP;AACF,WAAK,GAAL;AACE,aAAKkB,MAAL,GAAc,KAAKZ,SAAnB;AACA,aAAKY,MAAL,CAAYF,SAAZ,CAAsBC,IAAtB;AACA,eAAO,IAAP;AACF,WAAK,KAAL;AACE,aAAKC,MAAL,GAAc,KAAKV,SAAnB;AACA,aAAKU,MAAL,CAAYF,SAAZ,CAAsBC,IAAtB;AACA,eAAO,IAAP;AACF;AACE,eAAO,KAAP;AAbJ;AAeD,GAtCsC;AAuCvCG,aAAW,mBAASN,IAAT,EAAe;AACxB,QAAI,KAAKI,MAAT,EAAiB;AACf,WAAKA,MAAL,CAAYE,SAAZ,CAAsBN,IAAtB;AACD;AACF,GA3CsC;AA4CvCO,cAAY,oBAASF,IAAT,EAAe;AACzB,YAAQA,IAAR;AACE,WAAK,GAAL;AACE,eAAO,KAAP;AACF,WAAK,GAAL;AACE,aAAKnB,KAAL,CAAWc,IAAX,GAAkB,KAAKI,MAAL,CAAYlB,KAA9B;AACA,aAAKkB,MAAL,GAAcI,SAAd;AACA,eAAO,IAAP;AACF,WAAK,KAAL;AACE,aAAKtB,KAAL,CAAWa,IAAX,GAAkB,KAAKK,MAAL,CAAYlB,KAA9B;AACA,aAAKkB,MAAL,GAAcI,SAAd;AACA,eAAO,IAAP;AACF;AACE,YAAI,KAAKJ,MAAT,EAAiB;AACf,eAAKA,MAAL,CAAYG,UAAZ,CAAuBF,IAAvB;AACD;AACD,eAAO,IAAP;AAfJ;AAiBD;AA9DsC,CAAzC","file":"rich-text-xform.js","sourcesContent":["/**\r\n * Copyright (c) 2015 Guyon Roche\r\n * LICENCE: MIT - please refer to LICENCE file included with this module\r\n * or https://github.com/guyonroche/exceljs/blob/master/LICENSE\r\n */\r\n\r\n'use strict';\r\n\r\nvar TextXform = require('./text-xform');\r\nvar FontXform = require('../style/font-xform');\r\n\r\nvar utils = require('../../../utils/utils');\r\nvar BaseXform = require('../base-xform');\r\n\r\n// <r>\r\n//   <rPr>\r\n//     <sz val=\"11\"/>\r\n//     <color theme=\"1\" tint=\"5\"/>\r\n//     <rFont val=\"Calibri\"/>\r\n//     <family val=\"2\"/>\r\n//     <scheme val=\"minor\"/>\r\n//   </rPr>\r\n//   <t xml:space=\"preserve\"> is </t>\r\n// </r>\r\n\r\nvar RichTextXform = module.exports = function(model) {\r\n  this.model = model;\r\n};\r\n\r\nRichTextXform.FONT_OPTIONS = {\r\n  tagName: 'rPr',\r\n  fontNameTag: 'rFont'\r\n};\r\n\r\nutils.inherits(RichTextXform, BaseXform, {\r\n\r\n  get tag() { return 'r'; },\r\n\r\n  get textXform() { return this._textXform || (this._textXform = new TextXform()); },\r\n  get fontXform() { return this._fontXform || (this._fontXform = new FontXform(RichTextXform.FONT_OPTIONS)); },\r\n\r\n  render: function(xmlStream, model) {\r\n    model = model || this.model;\r\n\r\n    xmlStream.openNode('r');\r\n    if (model.font) {\r\n      this.fontXform.render(xmlStream, model.font);\r\n    }\r\n    this.textXform.render(xmlStream, model.text);\r\n    xmlStream.closeNode();\r\n  },\r\n\r\n  parseOpen: function(node) {\r\n    if (this.parser) {\r\n      this.parser.parseOpen(node);\r\n      return true;\r\n    }\r\n    switch (node.name) {\r\n      case 'r':\r\n        this.model = {};\r\n        return true;\r\n      case 't':\r\n        this.parser = this.textXform;\r\n        this.parser.parseOpen(node);\r\n        return true;\r\n      case 'rPr':\r\n        this.parser = this.fontXform;\r\n        this.parser.parseOpen(node);\r\n        return true;\r\n      default:\r\n        return false;\r\n    }\r\n  },\r\n  parseText: function(text) {\r\n    if (this.parser) {\r\n      this.parser.parseText(text);\r\n    }\r\n  },\r\n  parseClose: function(name) {\r\n    switch (name) {\r\n      case 'r':\r\n        return false;\r\n      case 't':\r\n        this.model.text = this.parser.model;\r\n        this.parser = undefined;\r\n        return true;\r\n      case 'rPr':\r\n        this.model.font = this.parser.model;\r\n        this.parser = undefined;\r\n        return true;\r\n      default:\r\n        if (this.parser) {\r\n          this.parser.parseClose(name);\r\n        }\r\n        return true;\r\n    }\r\n  }\r\n});\r\n"]}