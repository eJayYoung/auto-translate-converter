{"version":3,"sources":["../../../../../lib/xlsx/xform/style/alignment-xform.js"],"names":["Enums","require","utils","BaseXform","validation","horizontalValues","reduce","p","v","horizontal","value","undefined","verticalValues","vertical","wrapText","shrinkToFit","textRotation","validInt","indent","Math","max","readingOrder","ReadingOrder","LeftToRight","RightToLeft","textRotationXform","toXml","tr","round","toModel","AlignmentXform","module","exports","inherits","tag","render","xmlStream","model","addRollback","openNode","isValid","add","name","addAttribute","closeNode","commit","rollback","parseOpen","node","valid","truthy","attributes","parseInt","parseText","parseClose"],"mappings":"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","file":"alignment-xform.js","sourcesContent":["/**\r\n * Copyright (c) 2015 Guyon Roche\r\n * LICENCE: MIT - please refer to LICENCE file included with this module\r\n * or https://github.com/guyonroche/exceljs/blob/master/LICENSE\r\n */\r\n\r\n'use strict';\r\n\r\nvar Enums = require('../../../doc/enums');\r\n\r\nvar utils = require('../../../utils/utils');\r\nvar BaseXform = require('../base-xform');\r\n\r\nvar validation = {\r\n  horizontalValues: [\r\n    'left',\r\n    'center',\r\n    'right',\r\n    'fill',\r\n    'centerContinuous',\r\n    'distributed',\r\n    'justify'\r\n  ].reduce((p, v) => { p[v] = true; return p; }, {}),\r\n  horizontal: function(value) {\r\n    return this.horizontalValues[value] ? value : undefined;\r\n  },\r\n\r\n  verticalValues: [\r\n    'top',\r\n    'middle',\r\n    'bottom',\r\n    'distributed',\r\n    'justify'\r\n  ].reduce((p, v) => { p[v] = true; return p; }, {}),\r\n  vertical: function(value) {\r\n    if (value === 'middle') return 'center';\r\n    return this.verticalValues[value] ? value : undefined;\r\n  },\r\n  wrapText: function(value) {\r\n    return value ? true : undefined;\r\n  },\r\n  shrinkToFit: function(value) {\r\n    return value ? true : undefined;\r\n  },\r\n  textRotation: function(value) {\r\n    switch (value) {\r\n      case 'vertical':\r\n        return value;\r\n      default:\r\n        value = utils.validInt(value);\r\n        return (value >= -90) && (value <= 90) ? value : undefined;\r\n    }\r\n  },\r\n  indent: function(value) {\r\n    value = utils.validInt(value);\r\n    return Math.max(0, value);\r\n  },\r\n  readingOrder: function(value) {\r\n    switch (value) {\r\n      case 'ltr': return Enums.ReadingOrder.LeftToRight;\r\n      case 'rtl': return Enums.ReadingOrder.RightToLeft;\r\n      default: return undefined;\r\n    }\r\n  }\r\n};\r\n\r\nvar textRotationXform = {\r\n  toXml: function(textRotation) {\r\n    textRotation = validation.textRotation(textRotation);\r\n    if (textRotation) {\r\n      if (textRotation === 'vertical') {\r\n        return 255;\r\n      }\r\n\r\n      var tr = Math.round(textRotation);\r\n      if ((tr >= 0) && (tr <= 90)) {\r\n        return tr;\r\n      }\r\n\r\n      if ((tr < 0) && (tr >= -90)) {\r\n        return 90 - tr;\r\n      }\r\n    }\r\n    return undefined;\r\n  },\r\n  toModel: function(textRotation) {\r\n    var tr = utils.validInt(textRotation);\r\n    if (tr !== undefined) {\r\n      if (tr === 255) {\r\n        return 'vertical';\r\n      }\r\n      if ((tr >= 0) && (tr <= 90)) {\r\n        return tr;\r\n      }\r\n      if ((tr > 90) && (tr <= 180)) {\r\n        return 90 - tr;\r\n      }\r\n    }\r\n    return undefined;\r\n  }\r\n};\r\n\r\n// Alignment encapsulates translation from style.alignment model to/from xlsx\r\nvar AlignmentXform = module.exports = function() {\r\n};\r\n\r\nutils.inherits(AlignmentXform, BaseXform, {\r\n\r\n  get tag() { return 'alignment'; },\r\n\r\n  render: function(xmlStream, model) {\r\n    xmlStream.addRollback();\r\n    xmlStream.openNode('alignment');\r\n\r\n    var isValid = false;\r\n    function add(name, value) {\r\n      if (value) {\r\n        xmlStream.addAttribute(name, value);\r\n        isValid = true;\r\n      }\r\n    }\r\n    add('horizontal', validation.horizontal(model.horizontal));\r\n    add('vertical', validation.vertical(model.vertical));\r\n    add('wrapText', validation.wrapText(model.wrapText) ? '1' : false);\r\n    add('shrinkToFit', validation.shrinkToFit(model.shrinkToFit) ? '1' : false);\r\n    add('indent', validation.indent(model.indent));\r\n    add('textRotation', textRotationXform.toXml(model.textRotation));\r\n    add('readingOrder', validation.readingOrder(model.readingOrder));\r\n\r\n    xmlStream.closeNode();\r\n\r\n    if (isValid) {\r\n      xmlStream.commit();\r\n    } else {\r\n      xmlStream.rollback();\r\n    }\r\n  },\r\n  \r\n  parseOpen: function(node) {\r\n    var model = {};\r\n    \r\n    var valid = false;\r\n    function add(truthy, name, value) {\r\n      if (truthy) {\r\n        model[name] = value;\r\n        valid = true;\r\n      }\r\n    }\r\n    add(node.attributes.horizontal, 'horizontal', node.attributes.horizontal);\r\n    add(node.attributes.vertical, 'vertical', node.attributes.vertical === 'center' ? 'middle' : node.attributes.vertical);\r\n    add(node.attributes.wrapText, 'wrapText', !!node.attributes.wrapText);\r\n    add(node.attributes.shrinkToFit, 'shrinkToFit', !!node.attributes.shrinkToFit);\r\n    add(node.attributes.indent, 'indent', parseInt(node.attributes.indent, 10));\r\n    add(node.attributes.textRotation, 'textRotation', textRotationXform.toModel(node.attributes.textRotation));\r\n    add(node.attributes.readingOrder, 'readingOrder', node.attributes.readingOrder === '2' ? 'rtl' : 'ltr');\r\n    \r\n    this.model = valid ? model : null;\r\n  },\r\n  \r\n  parseText: function() {\r\n  },\r\n  parseClose: function() {\r\n    return false;\r\n  }\r\n});\r\n"]}