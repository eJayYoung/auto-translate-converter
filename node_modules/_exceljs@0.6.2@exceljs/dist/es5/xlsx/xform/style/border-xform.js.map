{"version":3,"sources":["../../../../../lib/xlsx/xform/style/border-xform.js"],"names":["utils","require","BaseXform","ColorXform","EdgeXform","name","map","color","inherits","tag","render","xmlStream","model","defaultColor","openNode","style","addAttribute","closeNode","parseOpen","node","parser","attributes","undefined","parseText","text","parseClose","validStyleValues","reduce","p","v","validStyle","value","BorderXform","module","exports","top","left","bottom","right","diagonal","up","down","add","edgeModel","edgeXform","Object","assign","reset","diagonalUp","diagonalDown","key","extensions"],"mappings":"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","file":"border-xform.js","sourcesContent":["/**\r\n * Copyright (c) 2015 Guyon Roche\r\n * LICENCE: MIT - please refer to LICENCE file included with this module\r\n * or https://github.com/guyonroche/exceljs/blob/master/LICENSE\r\n */\r\n\r\n'use strict';\r\n\r\nvar utils = require('../../../utils/utils');\r\nvar BaseXform = require('../base-xform');\r\n\r\nvar ColorXform = require('./color-xform');\r\n\r\nvar EdgeXform = function(name) {\r\n  this.name = name;\r\n  this.map = {\r\n    color: new ColorXform()\r\n  };\r\n};\r\n\r\nutils.inherits(EdgeXform, BaseXform, {\r\n  get tag() { return this.name; },\r\n\r\n  render: function(xmlStream, model, defaultColor) {\r\n    var color = (model && model.color) || defaultColor || this.defaultColor;\r\n    xmlStream.openNode(this.name);\r\n    if (model && model.style) {\r\n      xmlStream.addAttribute('style', model.style);\r\n      if (color) {\r\n        this.map.color.render(xmlStream, color);\r\n      }\r\n    }\r\n    xmlStream.closeNode();\r\n  },\r\n\r\n  parseOpen: function(node) {\r\n    if (this.parser) {\r\n      this.parser.parseOpen(node);\r\n      return true;\r\n    }\r\n    switch (node.name) {\r\n      case this.name:\r\n        var style = node.attributes.style;\r\n        if (style) {\r\n          this.model = {\r\n            style: style\r\n          };\r\n        } else {\r\n          this.model = undefined;\r\n        }\r\n        return true;\r\n      case 'color':\r\n        this.parser = this.map.color;\r\n        this.parser.parseOpen(node);\r\n        return true;\r\n      default:\r\n        return false;\r\n    }\r\n  },\r\n  parseText: function(text) {\r\n    if (this.parser) {\r\n      this.parser.parseText(text);\r\n    }\r\n  },\r\n  parseClose: function(name) {\r\n    if (this.parser) {\r\n      if (!this.parser.parseClose(name)) {\r\n        this.parser = undefined;\r\n      }\r\n      return true;\r\n    }\r\n\r\n    if (name === this.name) {\r\n      if (this.map.color.model) {\r\n        if (!this.model) {\r\n          this.model = {};\r\n        }\r\n        this.model.color = this.map.color.model;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  },\r\n\r\n  validStyleValues: [\r\n    'thin',\r\n    'dotted',\r\n    'dashDot',\r\n    'hair',\r\n    'dashDotDot',\r\n    'slantDashDot',\r\n    'mediumDashed',\r\n    'mediumDashDotDot',\r\n    'mediumDashDot',\r\n    'medium',\r\n    'double',\r\n    'thick'\r\n  ].reduce((p, v) => { p[v] = true; return p; }, {}),\r\n  validStyle: function(value) {\r\n    return this.validStyleValues[value];\r\n  }\r\n});\r\n\r\n// Border encapsulates translation from border model to/from xlsx\r\nvar BorderXform = module.exports = function() {\r\n  this.map = {\r\n    top: new EdgeXform('top'),\r\n    left: new EdgeXform('left'),\r\n    bottom: new EdgeXform('bottom'),\r\n    right: new EdgeXform('right'),\r\n    diagonal: new EdgeXform('diagonal')\r\n  };\r\n};\r\n\r\nutils.inherits(BorderXform, BaseXform, {\r\n  render: function(xmlStream, model) {\r\n    var color = model.color;\r\n    xmlStream.openNode('border');\r\n    if (model.diagonal && model.diagonal.style) {\r\n      if (model.diagonal.up) {\r\n        xmlStream.addAttribute('diagonalUp', '1');\r\n      }\r\n      if (model.diagonal.down) {\r\n        xmlStream.addAttribute('diagonalDown', '1');\r\n      }\r\n    }\r\n    function add(edgeModel, edgeXform) {\r\n      if (edgeModel && !edgeModel.color && model.color) {\r\n        // don't mess with incoming models\r\n        edgeModel = Object.assign({}, edgeModel, {color: model.color});\r\n      }\r\n      edgeXform.render(xmlStream, edgeModel, color);\r\n    }\r\n    add(model.left, this.map.left);\r\n    add(model.right, this.map.right);\r\n    add(model.top, this.map.top);\r\n    add(model.bottom, this.map.bottom);\r\n    add(model.diagonal, this.map.diagonal);\r\n\r\n    xmlStream.closeNode();\r\n  },\r\n\r\n  parseOpen: function(node) {\r\n    if (this.parser) {\r\n      this.parser.parseOpen(node);\r\n      return true;\r\n    }\r\n    switch (node.name) {\r\n      case 'border':\r\n        this.reset();\r\n        this.diagonalUp = !!node.attributes.diagonalUp;\r\n        this.diagonalDown = !!node.attributes.diagonalDown;\r\n        return true;\r\n      default:\r\n        this.parser = this.map[node.name];\r\n        if (this.parser) {\r\n          this.parser.parseOpen(node);\r\n          return true;\r\n        }\r\n        return false;\r\n    }\r\n  },\r\n  parseText: function(text) {\r\n    if (this.parser) {\r\n      this.parser.parseText(text);\r\n    }\r\n  },\r\n  parseClose: function(name) {\r\n    if (this.parser) {\r\n      if (!this.parser.parseClose(name)) {\r\n        this.parser = undefined;\r\n      }\r\n      return true;\r\n    }\r\n    if (name === 'border') {\r\n      var model = this.model = {};\r\n      var add = function(key, edgeModel, extensions) {\r\n        if (edgeModel) {\r\n          if (extensions) {\r\n            Object.assign(edgeModel, extensions);\r\n          }\r\n          model[key] = edgeModel;\r\n        }\r\n      };\r\n      add('left', this.map.left.model);\r\n      add('right', this.map.right.model);\r\n      add('top', this.map.top.model);\r\n      add('bottom', this.map.bottom.model);\r\n      add('diagonal', this.map.diagonal.model, {up: this.diagonalUp, down: this.diagonalDown});\r\n    }\r\n    return false;\r\n  }\r\n});\r\n"]}