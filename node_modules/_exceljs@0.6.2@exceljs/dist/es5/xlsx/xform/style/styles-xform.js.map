{"version":3,"sources":["../../../../../lib/xlsx/xform/style/styles-xform.js"],"names":["PromishLib","require","utils","Enums","XmlStream","BaseXform","StaticXform","ListXform","FontXform","FillXform","BorderXform","NumFmtXform","StyleXform","NUMFMT_BASE","StylesXform","module","exports","initialise","map","numFmts","tag","count","childXform","fonts","$","fills","borders","cellStyleXfs","cellXfs","xfId","numFmt","font","fill","border","style","cellStyles","STATIC_XFORMS","dxfs","tableStyles","extLst","init","inherits","STYLESHEET_ATTRIBUTES","xmlns","c","name","builtinId","defaultTableStyle","defaultPivotStyle","uri","defaultSlicerStyle","defaultTimelineStyle","initIndex","index","numFmtNextId","model","styles","_addFont","size","color","theme","family","scheme","_addBorder","_addStyle","numFmtId","fontId","fillId","borderId","_addFill","type","pattern","render","xmlStream","openXml","StdDocAttributes","openNode","length","forEach","numFmtXml","writeXml","closeNode","fontXml","fillXml","borderXml","styleXml","parseOpen","node","parser","parseText","text","parseClose","undefined","add","propName","xform","numFmtIndex","id","formatCode","addStyleModel","cellType","weakMap","has","get","ValueType","Number","_addNumFmtStr","Date","alignment","styleId","set","getStyleModel","getDefaultFmtCode","addStyle","group","part","xml","toXml","push","getDefaultFmtId","Mock","call","parseStream","stream","autodrain","Promish","resolve","dateStyleId","_dateStyleId","dateStyle"],"mappings":"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","file":"styles-xform.js","sourcesContent":["/**\r\n * Copyright (c) 2015 Guyon Roche\r\n * LICENCE: MIT - please refer to LICENCE file included with this module\r\n * or https://github.com/guyonroche/exceljs/blob/master/LICENSE\r\n */\r\n\r\n'use strict';\r\n\r\nvar PromishLib = require('../../../utils/promish');\r\n\r\nvar utils = require('../../../utils/utils');\r\nvar Enums = require('../../../doc/enums');\r\nvar XmlStream = require('../../../utils/xml-stream');\r\n\r\nvar BaseXform = require('../base-xform');\r\nvar StaticXform = require('../static-xform');\r\nvar ListXform = require('../list-xform');\r\nvar FontXform = require('./font-xform');\r\nvar FillXform = require('./fill-xform');\r\nvar BorderXform = require('./border-xform');\r\nvar NumFmtXform = require('./numfmt-xform');\r\nvar StyleXform = require('./style-xform');\r\n\r\n// custom numfmt ids start here\r\nvar NUMFMT_BASE = 164;\r\n\r\n// =============================================================================\r\n// StylesXform is used to generate and parse the styles.xml file\r\n// it manages the collections of fonts, number formats, alignments, etc\r\nvar StylesXform = module.exports = function(initialise) {\r\n  this.map = {\r\n    numFmts: new ListXform({tag: 'numFmts', count: true, childXform: new NumFmtXform()}),\r\n    fonts: new ListXform({tag: 'fonts', count: true, childXform: new FontXform(), $: {'x14ac:knownFonts': 1}}),\r\n    fills: new ListXform({tag: 'fills', count: true, childXform: new FillXform()}),\r\n    borders: new ListXform({tag: 'borders', count: true, childXform: new BorderXform()}),\r\n    cellStyleXfs: new ListXform({tag: 'cellStyleXfs', count: true, childXform: new StyleXform()}),\r\n    cellXfs: new ListXform({tag: 'cellXfs', count: true, childXform: new StyleXform({xfId: true})}),\r\n    \r\n    // for style manager\r\n    numFmt: new NumFmtXform(),\r\n    font: new FontXform(),\r\n    fill: new FillXform(),\r\n    border: new BorderXform(),\r\n    style: new StyleXform({xfId: true}),\r\n\r\n    cellStyles: StylesXform.STATIC_XFORMS.cellStyles,\r\n    dxfs: StylesXform.STATIC_XFORMS.dxfs,\r\n    tableStyles: StylesXform.STATIC_XFORMS.tableStyles,\r\n    extLst: StylesXform.STATIC_XFORMS.extLst\r\n  };\r\n\r\n  if (initialise) {\r\n    // StylesXform also acts as style manager and is used to build up styles-model during worksheet processing\r\n    this.init();\r\n  }\r\n};\r\n\r\nutils.inherits(StylesXform, BaseXform, {\r\n  STYLESHEET_ATTRIBUTES: {\r\n    xmlns: 'http://schemas.openxmlformats.org/spreadsheetml/2006/main',\r\n    'xmlns:mc': 'http://schemas.openxmlformats.org/markup-compatibility/2006',\r\n    'mc:Ignorable': 'x14ac x16r2',\r\n    'xmlns:x14ac': 'http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac',\r\n    'xmlns:x16r2': 'http://schemas.microsoft.com/office/spreadsheetml/2015/02/main'\r\n  },\r\n  STATIC_XFORMS: {\r\n    cellStyles: new StaticXform({tag: 'cellStyles', $: {count: 1}, c: [{tag: 'cellStyle', $: {name: 'Normal', xfId: 0, builtinId: 0}}]}),\r\n    dxfs: new StaticXform({tag: 'dxfs', $: {count: 0}}),\r\n    tableStyles: new StaticXform({tag: 'tableStyles', $: {count: 0, defaultTableStyle: 'TableStyleMedium2', defaultPivotStyle: 'PivotStyleLight16'}}),\r\n    extLst: new StaticXform({tag: 'extLst', c: [\r\n      {tag: 'ext', $: {uri: '{EB79DEF2-80B8-43e5-95BD-54CBDDF9020C}', 'xmlns:x14': 'http://schemas.microsoft.com/office/spreadsheetml/2009/9/main'}, c: [\r\n        {tag: 'x14:slicerStyles', $: {defaultSlicerStyle: 'SlicerStyleLight1'}}\r\n      ]},\r\n      {tag: 'ext', $: {uri: '{9260A510-F301-46a8-8635-F512D64BE5F5}', 'xmlns:x15': 'http://schemas.microsoft.com/office/spreadsheetml/2010/11/main'}, c: [\r\n        {tag: 'x15:timelineStyles', $: {defaultTimelineStyle: 'TimeSlicerStyleLight1'}}\r\n      ]}\r\n    ]})\r\n  }\r\n}, {\r\n\r\n  initIndex: function() {\r\n    this.index = {\r\n      style: {},\r\n      numFmt: {},\r\n      numFmtNextId: 164, // start custom format ids here\r\n      font: {},\r\n      border: {},\r\n      fill: {}\r\n    };\r\n  },\r\n\r\n  init: function() {\r\n    // Prepare for Style Manager role\r\n    this.model = {\r\n      styles: [],\r\n      numFmts: [],\r\n      fonts: [],\r\n      borders: [],\r\n      fills: []\r\n    };\r\n\r\n    this.initIndex();\r\n\r\n    // default (zero) font\r\n    this._addFont({size: 11, color: {theme: 1}, name: 'Calibri', family: 2, scheme: 'minor'});\r\n\r\n    // default (zero) border\r\n    this._addBorder({});\r\n\r\n    // add default (all zero) style\r\n    this._addStyle({numFmtId: 0, fontId: 0, fillId: 0, borderId: 0, xfId: 0});\r\n\r\n    // add default fills\r\n    this._addFill({type: 'pattern', pattern: 'none'});\r\n    this._addFill({type: 'pattern', pattern: 'gray125'});\r\n  },\r\n\r\n  render: function(xmlStream, model) {\r\n    model = model || this.model;\r\n    //\r\n    //   <fonts count=\"2\" x14ac:knownFonts=\"1\">\r\n    xmlStream.openXml(XmlStream.StdDocAttributes);\r\n\r\n    xmlStream.openNode('styleSheet', StylesXform.STYLESHEET_ATTRIBUTES);\r\n\r\n    if (this.index) {\r\n      // model has been built by style manager role (contains xml)\r\n      if (model.numFmts && model.numFmts.length) {\r\n        xmlStream.openNode('numFmts', {count: model.numFmts.length});\r\n        model.numFmts.forEach(function(numFmtXml) {\r\n          xmlStream.writeXml(numFmtXml);\r\n        });\r\n        xmlStream.closeNode();\r\n      }\r\n\r\n      xmlStream.openNode('fonts', {count: model.fonts.length});\r\n      model.fonts.forEach(function(fontXml) {\r\n        xmlStream.writeXml(fontXml);\r\n      });\r\n      xmlStream.closeNode();\r\n\r\n      xmlStream.openNode('fills', {count: model.fills.length});\r\n      model.fills.forEach(function(fillXml) {\r\n        xmlStream.writeXml(fillXml);\r\n      });\r\n      xmlStream.closeNode();\r\n\r\n      xmlStream.openNode('borders', {count: model.borders.length});\r\n      model.borders.forEach(function(borderXml) {\r\n        xmlStream.writeXml(borderXml);\r\n      });\r\n      xmlStream.closeNode();\r\n\r\n      this.map.cellStyleXfs.render(xmlStream, [{numFmtId: 0, fontId: 0, fillId: 0, borderId: 0, xfId: 0}]);\r\n\r\n      xmlStream.openNode('cellXfs', {count: model.styles.length});\r\n      model.styles.forEach(function(styleXml) {\r\n        xmlStream.writeXml(styleXml);\r\n      });\r\n      xmlStream.closeNode();\r\n    } else {\r\n      // model is plain JSON and needs to be xformed\r\n      this.map.numFmts.render(xmlStream, model.numFmts);\r\n      this.map.fonts.render(xmlStream, model.fonts);\r\n      this.map.fills.render(xmlStream, model.fills);\r\n      this.map.borders.render(xmlStream, model.borders);\r\n      this.map.cellStyleXfs.render(xmlStream, [{numFmtId: 0, fontId: 0, fillId: 0, borderId: 0, xfId: 0}]);\r\n      this.map.cellXfs.render(xmlStream, model.styles);\r\n    }\r\n\r\n    // trailing static stuff\r\n    StylesXform.STATIC_XFORMS.cellStyles.render(xmlStream);\r\n    StylesXform.STATIC_XFORMS.dxfs.render(xmlStream);\r\n    StylesXform.STATIC_XFORMS.tableStyles.render(xmlStream);\r\n    StylesXform.STATIC_XFORMS.extLst.render(xmlStream);\r\n\r\n    xmlStream.closeNode();\r\n  },\r\n\r\n  parseOpen: function(node) {\r\n    if (this.parser) {\r\n      this.parser.parseOpen(node);\r\n      return true;\r\n    }\r\n    switch (node.name) {\r\n      case 'styleSheet':\r\n        this.initIndex();\r\n        return true;\r\n      default:\r\n        this.parser = this.map[node.name];\r\n        if (this.parser) {\r\n          this.parser.parseOpen(node);\r\n        }\r\n        return true;\r\n    }\r\n  },\r\n  parseText: function(text) {\r\n    if (this.parser) {\r\n      this.parser.parseText(text);\r\n    }\r\n  },\r\n  parseClose: function(name) {\r\n    if (this.parser) {\r\n      if (!this.parser.parseClose(name)) {\r\n        this.parser = undefined;\r\n      }\r\n      return true;\r\n    }\r\n    switch (name) {\r\n      case 'styleSheet':\r\n        var model = this.model = {};\r\n        var add = function(propName, xform) {\r\n          if (xform.model && xform.model.length) {\r\n            model[propName] = xform.model;\r\n          }\r\n        };\r\n        add('numFmts', this.map.numFmts);\r\n        add('fonts', this.map.fonts);\r\n        add('fills', this.map.fills);\r\n        add('borders', this.map.borders);\r\n        add('styles', this.map.cellXfs);\r\n\r\n        // index numFmts\r\n        this.index = {\r\n          model: [],\r\n          numFmt: []\r\n        };\r\n        if (model.numFmts) {\r\n          var numFmtIndex = this.index.numFmt;\r\n          model.numFmts.forEach(function(numFmt) {\r\n            numFmtIndex[numFmt.id] = numFmt.formatCode;\r\n          });\r\n        }\r\n\r\n        return false;\r\n      default:\r\n        // not quite sure how we get here!\r\n        return true;\r\n    }\r\n  },\r\n\r\n  // add a cell's style model to the collection\r\n  // each style property is processed and cross-referenced, etc.\r\n  // the styleId is returned. Note: cellType is used when numFmt not defined\r\n  addStyleModel: function(model, cellType) {\r\n    if (!model) {\r\n      return 0;\r\n    }\r\n\r\n    // if we have seen this style object before, assume it has the same styleId\r\n    if (this.weakMap && this.weakMap.has(model)) {\r\n      return this.weakMap.get(model);\r\n    }\r\n\r\n    var style = {};\r\n    cellType = cellType || Enums.ValueType.Number;\r\n\r\n    if (model.numFmt) {\r\n      style.numFmtId = this._addNumFmtStr(model.numFmt);\r\n    } else {\r\n      switch (cellType) {\r\n        case Enums.ValueType.Number:\r\n          style.numFmtId = this._addNumFmtStr('General');\r\n          break;\r\n        case Enums.ValueType.Date:\r\n          style.numFmtId = this._addNumFmtStr('mm-dd-yy');\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n    }\r\n\r\n    if (model.font) {\r\n      style.fontId = this._addFont(model.font);\r\n    }\r\n\r\n    if (model.border) {\r\n      style.borderId = this._addBorder(model.border);\r\n    }\r\n\r\n    if (model.fill) {\r\n      style.fillId = this._addFill(model.fill);\r\n    }\r\n\r\n    if (model.alignment) {\r\n      style.alignment = model.alignment;\r\n    }\r\n\r\n    var styleId = this._addStyle(style);\r\n    if (this.weakMap) {\r\n      this.weakMap.set(model, styleId);\r\n    }\r\n    return styleId;\r\n  },\r\n\r\n  // given a styleId (i.e. s=\"n\"), get the cell's style model\r\n  // objects are shared where possible.\r\n  getStyleModel: function(id) {\r\n    // if the style doesn't exist return null\r\n    var style = this.model.styles[id];\r\n    if (!style) return null;\r\n\r\n    // have we built this model before?\r\n    var model = this.index.model[id];\r\n    if (model) return model;\r\n\r\n    // build a new model\r\n    model = this.index.model[id] = {};\r\n\r\n    // -------------------------------------------------------\r\n    // number format\r\n    if (style.numFmtId) {\r\n      var numFmt = this.index.numFmt[style.numFmtId] || NumFmtXform.getDefaultFmtCode(style.numFmtId);\r\n      if (numFmt) {\r\n        model.numFmt = numFmt;\r\n      }\r\n    }\r\n\r\n    function addStyle(name, group, styleId) {\r\n      if (styleId) {\r\n        var part = group[styleId];\r\n        if (part) {\r\n          model[name] = part;\r\n        }\r\n      }\r\n    }\r\n\r\n    addStyle('font', this.model.fonts, style.fontId);\r\n    addStyle('border', this.model.borders, style.borderId);\r\n    addStyle('fill', this.model.fills, style.fillId);\r\n\r\n    // -------------------------------------------------------\r\n    // alignment\r\n    if (style.alignment) {\r\n      model.alignment = style.alignment;\r\n    }\r\n\r\n    return model;\r\n  },\r\n\r\n  // =========================================================================\r\n  // Private Interface\r\n  _addStyle: function(style) {\r\n    var xml = this.map.style.toXml(style);\r\n    var index = this.index.style[xml];\r\n    if (index === undefined) {\r\n      index = this.index.style[xml] = this.model.styles.length;\r\n      this.model.styles.push(xml);\r\n    }\r\n    return index;\r\n  },\r\n\r\n  // =========================================================================\r\n  // Number Formats\r\n  _addNumFmtStr: function(formatCode) {\r\n    // check if default format\r\n    var index = NumFmtXform.getDefaultFmtId(formatCode);\r\n    if (index !== undefined) return index;\r\n\r\n    // check if already in\r\n    index = this.index.numFmt[formatCode];\r\n    if (index !== undefined) return index;\r\n\r\n\r\n    index = this.index.numFmt[formatCode] = NUMFMT_BASE + this.model.numFmts.length;\r\n    var xml = this.map.numFmt.toXml({id: index, formatCode: formatCode});\r\n    this.model.numFmts.push(xml);\r\n    return index;\r\n  },\r\n\r\n  // =========================================================================\r\n  // Fonts\r\n  _addFont: function(font) {\r\n    var xml = this.map.font.toXml(font);\r\n    var index = this.index.font[xml];\r\n    if (index === undefined) {\r\n      index = this.index.font[xml] = this.model.fonts.length;\r\n      this.model.fonts.push(xml);\r\n    }\r\n    return index;\r\n  },\r\n\r\n  // =========================================================================\r\n  // Borders\r\n  _addBorder: function(border) {\r\n    var xml = this.map.border.toXml(border);\r\n    var index = this.index.border[xml];\r\n    if (index === undefined) {\r\n      index = this.index.border[xml] = this.model.borders.length;\r\n      this.model.borders.push(xml);\r\n    }\r\n    return index;\r\n  },\r\n\r\n  // =========================================================================\r\n  // Fills\r\n  _addFill: function(fill) {\r\n    var xml = this.map.fill.toXml(fill);\r\n    var index = this.index.fill[xml];\r\n    if (index === undefined) {\r\n      index = this.index.fill[xml] = this.model.fills.length;\r\n      this.model.fills.push(xml);\r\n    }\r\n    return index;\r\n  }\r\n\r\n  // =========================================================================\r\n});\r\n\r\n// the stylemanager mock acts like StyleManager except that it always returns 0 or {}\r\nStylesXform.Mock = function() {\r\n  StylesXform.call(this);\r\n  this.model = {\r\n    styles: [{numFmtId: 0, fontId: 0, fillId: 0, borderId: 0, xfId: 0}],\r\n    numFmts: [],\r\n    fonts: [{size: 11, color: {theme: 1}, name: 'Calibri', family: 2, scheme: 'minor'}],\r\n    borders: [{}],\r\n    fills: [\r\n      {type: 'pattern', pattern: 'none'},\r\n      {type: 'pattern', pattern: 'gray125'}\r\n    ]\r\n  };\r\n};\r\n\r\nutils.inherits(StylesXform.Mock, StylesXform, {\r\n  // =========================================================================\r\n  // Style Manager Interface\r\n\r\n  // override normal behaviour - consume and dispose\r\n  parseStream: function(stream) {\r\n    stream.autodrain();\r\n    return PromishLib.Promish.resolve();\r\n  },\r\n\r\n  // add a cell's style model to the collection\r\n  // each style property is processed and cross-referenced, etc.\r\n  // the styleId is returned. Note: cellType is used when numFmt not defined\r\n  addStyleModel: function(model, cellType) {\r\n    switch (cellType) {\r\n      case Enums.ValueType.Date:\r\n        return this.dateStyleId;\r\n      default:\r\n        return 0;\r\n    }\r\n  },\r\n\r\n  get dateStyleId() {\r\n    if (!this._dateStyleId) {\r\n      var dateStyle = {\r\n        numFmtId: NumFmtXform.getDefaultFmtId('mm-dd-yy')\r\n      };\r\n      this._dateStyleId = this.model.styles.length;\r\n      this.model.styles.push(dateStyle);\r\n    }\r\n    return this._dateStyleId;\r\n  },\r\n\r\n  // given a styleId (i.e. s=\"n\"), get the cell's style model\r\n  // objects are shared where possible.\r\n  getStyleModel: function(/* id */) {\r\n    return {};\r\n  }\r\n});\r\n"]}